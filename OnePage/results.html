<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>AirAware - Results</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/AA.png" rel="icon">
  <link href="assets/img/AirAware.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- GN: load the D3.js library -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body class="results-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

      <a href="home.html" class="logo d-flex align-items-center me-auto">
        <h1 class="sitename">AirAware</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="home.html">Home</a></li>
          <li><a href="workflow.html">Workflow</a></li>
          <li><a href="results.html" class="active">Results</a></li>
          <li><a href="webgis.html">WebGIS</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <!-- No extra header button on results page -->
    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <div class="bg-image"></div>
      <div class="content">
        <h1>Results</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Results</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Results Section -->
    <section id="results" class="service-details section">

      <!-- GN: Yearly mean histograms -->
      <div class="container">

        <!-- GN: Graphs explanation -->
        <div class="container section-title" data-aos="fade-up">
          <h2>How to Use the Graphs</h2>
          <p>Understand pollutant trends and exposure patterns through interactive visual tools.</p>
        </div>

        <div class="container" data-aos="fade-up" data-aos-delay="100" style="margin-bottom: 40px;">
          <p>The results page is divided into three sections, one for each of the studied pollutants.<br>
            By default, each section displays a histogram where the bars represent the total annual average value,
            broken down by all land cover classes.
            The bars are stacked, with each segment indicating the contribution of a specific land cover type to the
            total value across the study area.
            A dot on top of each bar marks the dominant exposure class in that particular year.
          </p>

          <div class="row gy-4 align-items-center">

            <div class="col-lg-6 content" data-aos="fade-right" data-aos-delay="100">
              <ul>
                <li style="margin-bottom: 1rem;">
                  <i class="bi bi-cursor-fill" style="color:#2487ce;"></i>
                  <span><strong>Click a land cover type in the legend</strong> to isolate and view only that
                    category.<br>Click again to restore the full stacked bar view.</span>
                </li>
                <li>
                  <i class="bi bi-cursor-fill" style="color:#2487ce;"></i>
                  <span><strong>Click a year on the horizontal axis</strong> to explore two detailed pie charts for that
                    point in time.<br>Click again to return to the bar chart.</span>
                </li>
              </ul>
            </div>

            <div class="col-lg-6" data-aos="fade-left" data-aos-delay="100">
              <p>
                Isolating a land cover category allows you to focus on how pollutant levels vary within that environment
                over the years.
                When you click on a specific land cover, both the yearly maximum and average pollutant values for that
                category are displayed, helping to trace trends over time.
              </p>
              <p>
                The pie charts provide a snapshot of the selected year: one shows the distribution of land cover types
                across the study area,
                while the other displays the distribution of exposure classes, indicating the percentage of the study
                area falling into each class based on the combination of pollution levels and population density.
              </p>
            </div>

          </div>

        </div>

        <!-- GN: pm2p5 graphs -->
        <div style="background-color: #f8f9fa; padding: 30px; margin-bottom: 30px;" id="pm2p5-title">
          <div class="container" data-aos="fade-zoom-in" data-aos-delay="100">
            <div class="section-title text-center" style="margin-bottom: 30px;">
              <h2>PM<sub>2.5</sub></h2>
            </div>
            <div class="row gy-1 justify-content-center">
              <div id="pm2p5-bar-chart"></div>
            </div>
          </div>
        </div>

        <!-- GN: pm10 graphs -->
        <div style="background-color: #f8f9fa; padding: 30px; margin-bottom: 30px;" id="pm10-title">
          <div class="container" data-aos="fade-zoom-in" data-aos-delay="100">
            <div class="section-title text-center" style="margin-bottom: 30px;">
              <h2>PM<sub>10</sub></h2>
            </div>
            <div class="row gy-1 justify-content-center">
              <div id="pm10-bar-chart"></div>
            </div>
          </div>
        </div>

        <!-- GN: NO2 graphs -->
        <div style="background-color: #f8f9fa; padding: 30px; margin-bottom: 30px;" id="no2-title">
          <div class="container" data-aos="fade-zoom-in" data-aos-delay="100">
            <div class="section-title text-center" style="margin-bottom: 30px;">
              <h2>NO<sub>2</sub></h2>
            </div>
            <div class="row gy-1 justify-content-center">
              <div id="no2-bar-chart"></div>
            </div>
          </div>
        </div>

      </div><!-- GN: Yearly mean histograms -->

    </section><!-- /Results Section -->
  </main>

  <footer id="footer" class="footer light-background">

    <div class="container footer-top">

      <div class="row gy-3">

        <div class="col-lg-2 col-md-12 footer-about">
          <div style="width:150px; height:150px; overflow:hidden;">
            <img src="assets/img/AirAware.png" alt="" style="width:100%; height:100%; object-fit: contain;">
          </div>
        </div>

        <div class="col-lg-4 col-md-12 footer-about">
          <a href="home.html" class="logo d-flex align-items-center">
            <span class="sitename">AirAware</span>
          </a>
          <p><strong>Air matters. Data speaks. Maps reveal.</strong><br>
            A collaborative GIS project on air pollution in Hungary by three students from the MSc Geoinformatics
            Engineering program at Politecnico di Milano.</p>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Pollutants</h4>
          <ul>
            <li><a href="home.html#pollutants-info">Overview</a></li>
            <li><a href="results.html#pm2p5-title">PM<sub>2.5</sub></a></li>
            <li><a href="results.html#pm10-title">PM<sub>10</sub></a></li>
            <li><a href="results.html#no2-title">NO<sub>2</sub></a></li>
          </ul>
        </div>

        <div class="col-lg-4 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>

          <div class="contact-person">
            <strong>Davide Galluzzo</strong> -
            <a href="mailto:davide.galluzzo@mail.polimi.it">davide.galluzzo@mail.polimi.it</a>
            <a href="https://github.com/galluzzodavide" target="_blank" rel="noopener noreferrer" class="ms-2">
              <i class="bi bi-github"></i>
            </a>
          </div>

          <div class="contact-person">
            <strong>Giada Nespoli</strong> -
            <a href="mailto:giada.nespoli@mail.polimi.it">giada.nespoli@mail.polimi.it</a>
            <a href="https://github.com/giadanespoli" target="_blank" rel="noopener noreferrer" class="ms-2">
              <i class="bi bi-github"></i>
            </a>
          </div>

          <div class="contact-person">
            <strong>Luciana Bertucci</strong> -
            <a href="mailto:luciana.bertucci@mail.polimi.it">luciana.bertucci@mail.polimi.it</a>
            <a href="https://github.com/lucibertucci" target="_blank" rel="noopener noreferrer" class="ms-2">
              <i class="bi bi-github"></i>
            </a>
          </div>

        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1 sitename">AirAware</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- GN: Pollutants yearly means interactive histograms -->
  <script>

    // Pollutants data 
    const years = ['2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022'];
    const landCovers = ['Agriculture', 'Forest', 'Grassland', 'Wetland', 'Settlement', 'Other'];
    const colors = ['#a0b763', '#4c6e53', '#c4e2a7', '#68a3c2', '#6e6e6e', '#b09774'];

    const pm2p5max = [
      { year: '2013', Agriculture: 15.176982243855795, Forest: 15.176982243855795, Grassland: 15.176982243855795, Wetland: 15.032713492711386, Settlement: 15.176982243855795, Other: 15.176982243855795 },
      { year: '2014', Agriculture: 15.308128277460733, Forest: 15.308128277460733, Grassland: 15.308128277460733, Wetland: 14.8025590578715, Settlement: 15.308128277460733, Other: 15.247998396555582 },
      { year: '2015', Agriculture: 17.15513849258423, Forest: 17.15513849258423, Grassland: 17.15513849258423, Wetland: 16.72590724627177, Settlement: 17.15513849258423, Other: 17.15513849258423 },
      { year: '2016', Agriculture: 17.372815211613972, Forest: 17.37281521161397245, Grassland: 17.372815211613972, Wetland: 17.014524698257446, Settlement: 17.372815211613972, Other: 17.372815211613972 },
      { year: '2017', Agriculture: 16.620910962422688, Forest: 16.845247268676758, Grassland: 16.167422930399578, Wetland: 15.181847333908081, Settlement: 16.192275603612263, Other: 15.450771808624268 },
      { year: '2018', Agriculture: 16.983087142308552, Forest: 16.983087142308552, Grassland: 16.983087142308552, Wetland: 16.595237890879314, Settlement: 16.983087142308552, Other: 16.969940821329754 },
      { year: '2019', Agriculture: 19.50590173403422, Forest: 19.50590173403422, Grassland: 19.50590173403422, Wetland: 18.686543544133503, Settlement: 19.50590173403422, Other: 19.50590173403422 },
      { year: '2020', Agriculture: 16.31001369158427, Forest: 16.31001369158427, Grassland: 16.31001369158427, Wetland: 15.554859081904093, Settlement: 16.31001369158427, Other: 16.31001369158427 },
      { year: '2021', Agriculture: 18.84598179658254, Forest: 18.84598179658254, Grassland: 18.84598179658254, Wetland: 17.78404939174652, Settlement: 18.84598179658254, Other: 18.805418491363525 },
      { year: '2022', Agriculture: 27.258045513465213, Forest: 27.258045513465213, Grassland: 24.240456636395947, Wetland: 27.258045513465213, Settlement: 27.258045513465213, Other: 22.15005673997021 },
    ];
    const pm2p5mean = [
      { year: '2013', Agriculture: 12.953749951398269, Forest: 12.83664866719892, Grassland: 12.892854479935483, Wetland: 12.749934440104917, Settlement: 13.2959488532206635, Other: 12.793233664702123 },
      { year: '2014', Agriculture: 12.945113979108282, Forest: 12.819080450522854, Grassland: 12.960170608120368, Wetland: 12.423025165335783, Settlement: 13.31090754261544, Other: 12.762786327276459 },
      { year: '2015', Agriculture: 15.214608832020318, Forest: 15.10682448809313, Grassland: 15.097713031824172, Wetland: 14.841459734931693, Settlement: 15.447283436704293, Other: 15.032802340399531 },
      { year: '2016', Agriculture: 15.256556089389361, Forest: 15.107494943111597, Grassland: 15.151616113731185, Wetland: 14.706312948811831, Settlement: 15.527598169914333, Other: 15.07430913803541 },
      { year: '2017', Agriculture: 13.604991197237993, Forest: 13.469174865700689, Grassland: 13.578546181574096, Wetland: 13.15623406734034, Settlement: 13.861966917557003, Other: 13.330127895892588 },
      { year: '2018', Agriculture: 14.120934503432654, Forest: 13.872992407062776, Grassland: 13.998197349333006, Wetland: 13.8050353244804, Settlement: 14.563511140100552, Other: 13.963340748510474 },
      { year: '2019', Agriculture: 15.317184630834694, Forest: 14.72232473022112, Grassland: 15.527960150944914, Wetland: 14.293344798031534, Settlement: 15.971402471430453, Other: 14.859458464040106 },
      { year: '2020', Agriculture: 12.67636425600653, Forest: 12.117329354043159, Grassland: 12.782806253751794, Wetland: 11.879985701977613, Settlement: 13.337417142130516, Other: 12.285913804164387 },
      { year: '2021', Agriculture: 14.735892821734291, Forest: 14.266776186321142, Grassland: 14.91422281728136, Wetland: 13.717935664793355, Settlement: 15.535672549860514, Other: 14.202512608213873 },
      { year: '2022', Agriculture: 12.853600316887782, Forest: 12.662191095382479, Grassland: 12.77595630821557, Wetland: 12.556492779373183, Settlement: 13.383839907161596, Other: 12.70245988716617 },
    ];

    const pm10max = [
      { year: '2013', Agriculture: 34.54489899, Forest: 33.46869659, Grassland: 34.98288727, Wetland: 28.52257729, Settlement: 36.65274048, Other: 29.76473427 },
      { year: '2014', Agriculture: 21.08507156, Forest: 21.38138771, Grassland: 21.51143837, Wetland: 20.63183784, Settlement: 22.0325737, Other: 20.1280365 },
      { year: '2015', Agriculture: 33.44776535, Forest: 30.78423691, Grassland: 32.38028336, Wetland: 27.74621201, Settlement: 33.66698456, Other: 32.62925339 },
      { year: '2016', Agriculture: 33.4274826, Forest: 32.54592514, Grassland: 33.15644836, Wetland: 31.57196808, Settlement: 34.14050674, Other: 31.41160202 },
      { year: '2017', Agriculture: 21.29987335, Forest: 22.02774048, Grassland: 21.01952934, Wetland: 19.35776901, Settlement: 18.85408592, Other: 17.62775803 },
      { year: '2018', Agriculture: 25.17133331, Forest: 24.71713829, Grassland: 25.6117115, Wetland: 22.50363922, Settlement: 26.13867188, Other: 24.25593376 },
      { year: '2019', Agriculture: 30.4024601, Forest: 29.99837494, Grassland: 29.88920784, Wetland: 26.30245018, Settlement: 30.2368145, Other: 27.49014854 },
      { year: '2020', Agriculture: 25.44854164, Forest: 25.0421505, Grassland: 23.10439301, Wetland: 20.60498238, Settlement: 24.61334991, Other: 21.07036972 },
      { year: '2021', Agriculture: 38.31863022, Forest: 34.63248444, Grassland: 36.39828491, Wetland: 27.78613091, Settlement: 38.14982986, Other: 32.97729492 },
      { year: '2022', Agriculture: 31.07202129, Forest: 30.29225081, Grassland: 30.52022595, Wetland: 27.02950633, Settlement: 31.97234336, Other: 27.36068395 },
    ];
    const pm10mean = [
      { year: '2013', Agriculture: 27.46967618, Forest: 26.9396431, Grassland: 27.85696493, Wetland: 26.28873698, Settlement: 28.32562419, Other: 26.05091465 },
      { year: '2014', Agriculture: 18.06920492, Forest: 18.08892645, Grassland: 18.18816217, Wetland: 18.03797245, Settlement: 18.48560571, Other: 18.17417324 },
      { year: '2015', Agriculture: 27.19646271, Forest: 26.19988999, Grassland: 27.28668347, Wetland: 26.37520186, Settlement: 27.39815721, Other: 26.42503716 },
      { year: '2016', Agriculture: 28.75803228, Forest: 28.78866833, Grassland: 28.46613488, Wetland: 28.26694902, Settlement: 29.55547998, Other: 28.9501216 },
      { year: '2017', Agriculture: 16.21317012, Forest: 16.10376902, Grassland: 16.39834857, Wetland: 16.33357223, Settlement: 16.51254607, Other: 15.48135544 },
      { year: '2018', Agriculture: 20.93856828, Forest: 20.36269021, Grassland: 21.00956275, Wetland: 20.49096521, Settlement: 21.7537939, Other: 20.60522371 },
      { year: '2019', Agriculture: 23.4122688, Forest: 21.96849222, Grassland: 24.39518272, Wetland: 22.28768222, Settlement: 23.99808609, Other: 21.42008613 },
      { year: '2020', Agriculture: 18.65387146, Forest: 17.93275908, Grassland: 18.63632124, Wetland: 18.27397601, Settlement: 19.65962078, Other: 18.26235479 },
      { year: '2021', Agriculture: 24.41940023, Forest: 23.452262, Grassland: 18.63632124, Wetland: 23.39001115, Settlement: 26.70445129, Other: 22.7924394 },
      { year: '2022', Agriculture: 23.18061801, Forest: 22.65717555, Grassland: 23.23955599, Wetland: 23.16561714, Settlement: 24.85383428, Other: 22.65629266 },
    ];

    const no2max = [
      { year: '2013', Agriculture: 15.0968, Forest: 15.0968, Grassland: 14.7502, Wetland: 14.2965, Settlement: 15.0968, Other: 15.0968 },
      { year: '2014', Agriculture: 19.0504, Forest: 19.0504, Grassland: 18.4110, Wetland: 17.8616, Settlement: 19.0504, Other: 19.0504 },
      { year: '2015', Agriculture: 23.0806, Forest: 23.0806, Grassland: 21.9000, Wetland: 21.9000, Settlement: 23.0806, Other: 23.0806 },
      { year: '2016', Agriculture: 22.5498, Forest: 22.5498, Grassland: 21.1862, Wetland: 21.1862, Settlement: 22.5498, Other: 22.5498 },
      { year: '2017', Agriculture: 22.9749, Forest: 22.9749, Grassland: 21.9280, Wetland: 21.5795, Settlement: 22.9749, Other: 22.9749 },
      { year: '2018', Agriculture: 19.3152, Forest: 19.3152, Grassland: 17.8982, Wetland: 18.3391, Settlement: 19.3152, Other: 19.3152 },
      { year: '2019', Agriculture: 19.9525, Forest: 19.9525, Grassland: 21.8409, Wetland: 17.6487, Settlement: 19.9525, Other: 19.9525 },
      { year: '2020', Agriculture: 21.8409, Forest: 21.8409, Grassland: 20.0000, Wetland: 16.4515, Settlement: 21.8409, Other: 21.8409 },
      { year: '2021', Agriculture: 20.0000, Forest: 20.0000, Grassland: 25.9100, Wetland: 16.0000, Settlement: 20.0000, Other: 20.0000 },
      { year: '2022', Agriculture: 25.9100, Forest: 25.9100, Grassland: 25.9100, Wetland: 20.6844, Settlement: 25.9100, Other: 25.9100 }
    ];
    const no2mean = [
      { year: '2013', Agriculture: 5.2244, Forest: 5.3332, Grassland: 5.1035, Wetland: 5.1877, Settlement: 6.7012, Other: 5.7398 },
      { year: '2014', Agriculture: 6.6980, Forest: 6.8813, Grassland: 6.5684, Wetland: 6.5293, Settlement: 8.5182, Other: 7.2763 },
      { year: '2015', Agriculture: 8.7430, Forest: 8.8017, Grassland: 8.7529, Wetland: 8.6972, Settlement: 10.8771, Other: 10.2697 },
      { year: '2016', Agriculture: 8.6389, Forest: 8.5151, Grassland: 8.8139, Wetland: 8.3185, Settlement: 10.7722, Other: 9.7327 },
      { year: '2017', Agriculture: 8.9784, Forest: 9.0006, Grassland: 8.9976, Wetland: 8.4581, Settlement: 11.1514, Other: 9.3566 },
      { year: '2018', Agriculture: 6.2802, Forest: 6.0507, Grassland: 5.4229, Wetland: 5.9832, Settlement: 8.1533, Other: 6.5395 },
      { year: '2019', Agriculture: 5.5853, Forest: 5.4185, Grassland: 8.4916, Wetland: 5.3836, Settlement: 7.5193, Other: 5.9480 },
      { year: '2020', Agriculture: 8.4706, Forest: 8.3927, Grassland: 8.4598, Wetland: 8.3499, Settlement: 10.6476, Other: 9.1044 },
      { year: '2021', Agriculture: 8.3641, Forest: 7.8782, Grassland: 11.9534, Wetland: 7.8229, Settlement: 10.1479, Other: 8.9999 },
      { year: '2022', Agriculture: 12.1146, Forest: 12.0785, Grassland: 12.1146, Wetland: 11.9139, Settlement: 14.4416, Other: 12.8938 }
    ];

    const vulnerableGroupsByYear_pm2p5 = {
      2013: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2014: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2015: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2016: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2017: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2018: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2019: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2020: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2021: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2022: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 0, color: '#abd9e9' }, { label: '3', value: 100, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
    };
    const vulnerableGroupsByYear_pm10 = {
      2013: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 73.6, color: '#abd9e9' }, { label: '3', value: 26.4, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2014: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 100, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2015: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 95.48, color: '#abd9e9' }, { label: '3', value: 4.52, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2016: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 66.5, color: '#abd9e9' }, { label: '3', value: 33.5, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2017: [{ label: '1', value: 7.61, color: '#e0f3f8' }, { label: '2', value: 92.39, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2018: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 100, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2019: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 100, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2020: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 100, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2021: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 61, color: '#abd9e9' }, { label: '3', value: 39, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2022: [{ label: '1', value: 0, color: '#e0f3f8' }, { label: '2', value: 82.1, color: '#abd9e9' }, { label: '3', value: 17.9, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
    };
    const vulnerableGroupsByYear_no2 = {
      2013: [{ label: '1', value: 33.6, color: '#e0f3f8' }, { label: '2', value: 66.4, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2014: [{ label: '1', value: 32.9, color: '#e0f3f8' }, { label: '2', value: 67.1, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2015: [{ label: '1', value: 27.3, color: '#e0f3f8' }, { label: '2', value: 72.7, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2016: [{ label: '1', value: 26.4, color: '#e0f3f8' }, { label: '2', value: 73.6, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2017: [{ label: '1', value: 28.9, color: '#e0f3f8' }, { label: '2', value: 71.1, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2018: [{ label: '1', value: 24.7, color: '#e0f3f8' }, { label: '2', value: 75.3, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2019: [{ label: '1', value: 32.6, color: '#e0f3f8' }, { label: '2', value: 67.4, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2020: [{ label: '1', value: 37.7, color: '#e0f3f8' }, { label: '2', value: 62.3, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2021: [{ label: '1', value: 35.9, color: '#e0f3f8' }, { label: '2', value: 64.1, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
      2022: [{ label: '1', value: 34.5, color: '#e0f3f8' }, { label: '2', value: 65.5, color: '#abd9e9' }, { label: '3', value: 0, color: '#74add1' }, { label: '4', value: 0, color: '#4575b4' }, { label: '5', value: 0, color: '#313695' }],
    };

    // Function to create the interactive histogram
    function drawStackedChart(containerId, maxdata, meandata, vulnerableGroupsByYear) {

      const margin = { top: 30, right: 30, bottom: 60, left: 30 }; // Margins around the chart for axes and labels
      const width = 800 - margin.left - margin.right; // Width of the drawing area inside margins
      const height = 500 - margin.top - margin.bottom; // Height of the drawing area inside margins

      // Container for graphs and legends
      const container = d3.select(containerId) // Select the div with the ID of the pollutant
        .style('display', 'flex')
        .style('flex-direction', 'row') // Align items in a row
        .style('justify-content', 'center') // Center content horizontally within the container
        .style('align-items', 'center') // Center content vertically within the container
        .style('gap', '15px') // Set space between items 
        .style('margin', '0 auto'); // Center the entire container horizontally on the page

      // Container for graphs
      const graphs = container.append('div')
        .attr('id', 'chart-area')
      const svg = graphs.append('svg') // Set position
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .attr('overflow', 'visible')
        .append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

      // Container for legends
      const legend = container.append('div')
        .attr('id', 'legends-area')
        .style('display', 'flex')
        .style('flex-direction', 'column') // Align items in a column
        .style('align-items', 'flex-start') // Align items to the left
        .style('gap', '20px'); // Space between legends

      // Prepare data for stacked bar chart
      const stackedData = d3.stack()
        .keys(landCovers) // Stack all land cover categories as keys
        (maxdata); // Apply the stacking to the data array

      // Initialize means as a null array (only display means when a specific land cover is selected)
      const nullmeans = meandata.map(entry => ({
        year: entry.year,
        value: null,
      }));

      // Create a band scale for the x-axis (categorical)
      const x = d3.scaleBand()
        .domain(years) // Set the input domain to the list of years
        .range([0, width]) // Map years to positions between 0 and chart width (pixels)
        .padding(0.2); // Add space between the bars
      // Draw x-axis using the x scale
      let selectedYear = null; // Keep track of which year is selected (if any)
      // Draw x-axis
      const xaxis = svg.append('g')
        .attr('class', 'x-axis')
        .attr('transform', `translate(0, ${height})`) // Move x-axis group to the bottom of the chart
        .call(d3.axisBottom(x).tickFormat(d3.format("d")).tickSizeOuter(0)) // Draw the axis on the bottom without the final outer tick
      // Change when a year item is clicked
      xaxis.selectAll('.x-axis text') // Select all year labels
        .style('cursor', 'pointer') // Make the cursor a pointer to show it's clickable
        .on('click', function (event, d) {
          const clickedYear = d; // The year that was clicked
          // If clicked item is already selected
          if (selectedYear == clickedYear) {
            selectedYear = null;
            updateOpacity(xaxis.selectAll('.x-axis text'), selectedYear); // Reset opacity of the years
            svg.selectAll('g.pie-chart').remove(); // Remove any existing pie chart
            drawBars(stackedData, nullmeans, dominantClassByYear);
          }
          // If clicked item is not already selected
          else {
            selectedYear = clickedYear;
            const yearData = maxdata.find(row => row.year === clickedYear); // Find the data row matching the clicked year
            // Prepare pie data 1 for the selected year
            const pieData1 = landCovers.map((lc, i) => ({
              landCover: lc, // land cover category name
              value: yearData ? yearData[lc] : 0, // value for that year or 0 if not found
              color: colors[i] // corresponding color for land cover
            }));
            // Prepare pie data 2 for the selected year
            const pieData2 = vulnerableGroupsByYear[selectedYear];
            // Draws the pie charts
            updateOpacity(xaxis.selectAll('.x-axis text'), clickedYear); // Lower the opacity of the non selected years
            drawPieCharts(pieData1, pieData2, clickedYear);
          }
        });

      function Yaxis(Ydata) {
        // Create a linear scale for the y-axis (numerical)
        const maxVal = d3.max(Ydata[Ydata.length - 1], d => d[1]); // Determine max stacked bar height
        const maxValround = Math.ceil(maxVal); // Round up the maximum value to nearest integer
        const step = Math.ceil(maxValround / 11); // Calculate the step between each tick 
        const topTick = Math.ceil(maxValround / step) * step; // Calculate top tick
        
        const tickValues = []; // Initialize array to store custom tick values
        for (let i = 0; i <= topTick; i += step) { // Generate tick values from 0 to topTick with calculated step
          tickValues.push(i); // Add each tick value to the array
        }
        //const roundedMax = step * 11; // Determine the value of the last tick
        const y = d3.scaleLinear()
          .domain([0, topTick]) // Input domain: 0 to max stacked bar height
          .range([height, 0]); // The smallest data value maps to pixel position `height` (bottom of the chart) and the largest data value maps to pixel position 0 (top of the chart)
        // Draw y-axis using the y scale on the left side  
        svg.append('g')
          .attr('class', 'y-axis') // Add this class to enable updates later
          .call(d3.axisLeft(y).tickValues(tickValues).tickSizeOuter(0)); // Draw the axis on the left without the final outer tick
        return y;
      }

      // Calculate the dominant exposure class for each year
      const dominantClassByYear = years.map(year => {
        const groupData = vulnerableGroupsByYear[year]; // Get data for the current year
        const dominant = groupData.reduce((max, curr) => curr.value > max.value ? curr : max);  // Find the item with the highest value
        return { year, color: dominant.color, label: dominant.label };
      });

      // Function to draw stacked bars histogram
      function drawBars(maxToDraw, meanToDraw, dominantClassByYear) {

        // Remove the previous histogram 
        svg.selectAll('g.y-axis').remove();
        svg.selectAll('g.bar-group').remove();
        // Remove previous pie chart and reset opacity of the years
        svg.selectAll('g.pie-chart').remove();
        updateOpacity(d3.selectAll('g.x-axis text'), null);

        // Draw the y-axis
        const y = Yaxis(maxToDraw);

        // Create a container group for the land cover bars
        const groups = svg.append('g')
          .attr('class', 'bar-group')
          .selectAll('g') // Select all child groups (none exist yet, but this prepares for data binding)
          .data(maxToDraw) // Bind the data representing each land cover class
          .join('g') // Creates a child group for each land cover class in the data
          .attr('fill', (d, i) => {
            const idx = landCovers.indexOf(d.key); // Find the index of the land cover type
            return colors[idx]; // Use that index to set the fill color for this group
          });
        groups.selectAll('rect') // For each group, look for all rectangles (bars)
          .data(d => d) // Attach the specific data for each bar in this group
          .join('rect') // Create a rectangle for each piece of data
          .attr('x', d => x(d.data.year)) // Position the bar horizontally based on the year
          .attr('y', d => y(d[1])) // Position the top of the bar vertically
          .attr('width', x.bandwidth()) // Set the bar width to fit in the space for one year
          .attr('height', d => y(d[0]) - y(d[1])) // Set the bar height based on data values

        // Calculate the height of each column
        const totalByYear = {};
        maxToDraw.forEach(series => { // Loop through each data series
          series.forEach(d => {
            const year = d.data.year;
            if (!totalByYear[year]) totalByYear[year] = 0;  // Initialize total for the year if not already defined
            totalByYear[year] += d[1] - d[0]; // Add the bar height
          });
        });

        // Max value label on top of  the bars
        svg.selectAll('text.bar-label').remove(); // Remove old labels before adding new ones
        groups.selectAll('text.bar-label') // Select bar labels within each stacked group
          .data(d => d) // Attach the specific data for each bar in this group
          .join('text') // Create a new <text> element for each data item
          .attr('class', 'bar-label') // Assign a class for styling or future selection
          .attr('x', d => x(d.data.year) + x.bandwidth() / 2) // Position text horizontally at center of each bar
          .attr('y', d => y(d[1]) - 5) // Position text slightly above the top of each bar segment
          .attr('text-anchor', 'middle') // Center-align the text
          .attr('font-size', '12px')
          .attr('font-weight', 'bold')
          .attr('fill', '#000')
          .text(d => d[1].toFixed(1)); // Display the height of the bar segment

        // Mean values  
        const hasValidValues = Array.isArray(meanToDraw) && meanToDraw.some(d => d.value !== null);
        if (hasValidValues) {
          svg.selectAll('line.mean-left-line').remove(); // Remove mean left dashes before adding new ones
          svg.selectAll('line.mean-right-line').remove(); // Remove mean right dashes before adding new ones
          svg.selectAll('text.mean-label').remove(); // Remove mean labels before adding new ones
          groups.selectAll('circle.mean-left-line') // Select left dashes within each stacked group
            .data(meanToDraw) // Attach the specific data for each bar in this group
            .join('line') // Create a new left dash for each data item
            .attr('class', 'mean-left-line') // Assign a class for styling or future selection
            .attr('x1', d => x(d.year) + x.bandwidth() * 0.1) // Position left dash starting point 
            .attr('x2', d => x(d.year) + x.bandwidth() * 0.25) // Position left dash ending point 
            .attr('y1', d => y(d.value)).attr('y2', d => y(d.value)) // Position left dash at the mean value
            .attr('stroke', 'white')
            .attr('stroke-width', 1);
          groups.selectAll('circle.mean-right-line') // Select right dashes within each stacked group
            .data(meanToDraw) // Attach the specific data for each bar in this group
            .join('line') // Create a new right dash for each data item
            .attr('class', 'mean-left-line') // Assign a class for styling or future selection
            .attr('x1', d => x(d.year) + x.bandwidth() * 0.75) // Position right dash starting point 
            .attr('x2', d => x(d.year) + x.bandwidth() * 0.9) // Position right dash ending point 
            .attr('y1', d => y(d.value)).attr('y2', d => y(d.value)) // Position right dash at the mean value
            .attr('stroke', 'white')
            .attr('stroke-width', 1);
          groups.selectAll('text.mean-label') // Select labels within each stacked group
            .data(meanToDraw) // Attach the specific data for each bar in this group
            .join('text') // Create a new label for each data item
            .attr('class', 'mean-label') // Assign a class for styling or future selection
            .attr('x', d => x(d.year) + x.bandwidth() / 2) // Position label at the center of the bar
            .attr('y', d => y(d.value) + 3.5) // Position label between the dashes
            .attr('text-anchor', 'middle')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .attr('fill', 'white')
            .text(d => d.value.toFixed(1));
        } else { // No mean values if I have a null array
          svg.selectAll('line.mean-left-line').remove();
          svg.selectAll('line.mean-right-line').remove();
          svg.selectAll('text.mean-label').remove();
        }

        // Dot for the dominant exposure class on top 
        svg.selectAll('circle.exposure-dot').remove(); // Remove old circles before adding new ones
        groups.selectAll('circle.exposure-dot') // Select dots within each stacked group
          .data(dominantClassByYear) // Attach the specific data for each bar in this group
          .join('circle') // Create a new circle for each data item
          .attr('class', 'exposure-dot') // Assign a class for styling or future selection
          .attr('cx', d => x(d.year) + x.bandwidth() / 2) // Position dot horizontally at center of each bar
          .attr('cy', d => y(totalByYear[d.year]) - 30) // Position dot above the top of each bar segment
          .attr('r', 6) // Circle radius
          .attr('fill', d => d.color) // Fill with the color of the dominant class
          .attr('stroke', '#333') // Add border for visibility
          .attr('stroke-width', 1);
      }
      drawBars(stackedData, nullmeans, dominantClassByYear); // Draw the bars with the data

      // Draw interactive land cover legend
      const legend1 = legend.append('div')  // Create a container for the legend on the side
      let selectedLC = null; // Keep track of which land cover is selected (if any)
      legend1.append('div')
        .text('Land cover classes') // Legend titl
        .attr('class', 'legend-title')
        .style('font-weight', 'bold')
        .style('font-size', '16px')
        .style('margin-bottom', '10px');
      legend1.selectAll('div.legend-item') // Create one legend item for each land cover type
        .data(landCovers) // Bind land cover names to the legend items
        .enter()
        .append('div') // For each land cover that doesn't have a legend item yet, create a new box 
        .attr('class', 'legend-item')
        .style('display', 'flex') // Arrange color box and text in a row
        .style('align-items', 'center') // Vertically center color box and text
        .html((lc, i) => // Add colored boxes and labels
          `<div class="legend1-color-box" style="width: 18px; height: 18px; background-color: ${colors[i]}; margin-right: 6px;"></div>
      <span class="legend1-class">${lc}</span>`)
        // Change when a legend item is clicked
        .style('cursor', 'pointer') // Make the cursor a pointer to show it's clickable
        .on('click', function (event, lc) {
          // If clicked item is already selected
          if (selectedLC === lc) {
            selectedLC = null; // Deselect it
            updateOpacity(legend1.selectAll('div'), selectedLC); // Reset opacity of the legend 
            drawBars(stackedData, nullmeans, dominantClassByYear); // Show all bars again
          }
          // If clicked item is not already selected
          else {
            selectedLC = lc; // Select it
            // Prepare data only for the selected land cover
            const filteredStack = d3.stack()
              .keys([selectedLC]) // Use only the selected land cover as the key
              (maxdata); // Apply the stacking to the data array
            // Prepare mean values
            const means_landcover = meandata.map(entry => ({
              year: entry.year,
              value: entry[selectedLC],
            }));
            drawBars(filteredStack, means_landcover, dominantClassByYear); // Draw only selected bars
          }
          updateOpacity(legend1.selectAll('div'), selectedLC); // Lower the opacity of the non selected land covers
          legend1.selectAll('.legend-title').style('opacity', 1); // Make sure that the title stays opaque 
        })
      // Draw exposure class legend
      const legend2 = legend.append('div')  // Create a container for the legend on the side
        .style('min-width', '120px'); // Minimum width for the legend box
      legend2.append('div')
        .text('Exposure classes') // Legend title
        .attr('class', 'legend-title')
        .style('font-weight', 'bold')
        .style('font-size', '16px')
        .style('margin-bottom', '10px')
      legend2.selectAll('div.legend-item')
        .data(vulnerableGroupsByYear[2013]) // Bind land cover names to the legend items
        .enter()
        .append('div') // For each exposure class that doesn't have a legend item yet, create a new box 
        .attr('class', 'legend-item')
        .style('display', 'flex') // Arrange color box and text in a row
        .style('align-items', 'center') // Vertically center color box and text
        .html(d => // Add colored boxes and labels
          `<div class="legend2-color-box" style="width: 18px; height: 18px; background-color: ${d.color}; margin-right: 6px;"></div>
      <span class="legend2-class">${d.label}</span>`)

      // Function to change legend item opacity based on selection
      function updateOpacity(selector, selected) {
        // If the selected is null 
        if (selected === null || !selected) {
          selector.style('opacity', 1); // Restore the opacity of all
        }
        // If the selected is not null 
        else {
          selector.style('opacity', function (d) { return d !== selected ? 0.3 : 1; }); // Lower the opacity of all the non selected
          selector.filter(d => d === selected).selectAll('*').style('opacity', 1); // Assure that the selected and its children are fully opaque
        }
      }

      // Function to draw pie charts
      function drawPieCharts(pieData1, pieData2, clickedYear) {

        // Remove the previous histogram and reset opacity of the legend
        svg.selectAll('g.y-axis').remove();
        svg.selectAll('g.bar-group').remove();
        updateOpacity(legend.selectAll('div'), null);
        // Remove previous pie chart 
        svg.selectAll('g.pie-chart').remove();

        // Functions to generate the pie slices 
        const radius = Math.min(width / 2, height) / 2 - 20; // Set radius
        const pie = d3.pie() // Function to calculate the start and end angles for each slice 
          .value(d => d.value); // Use 'value' property of the pieData to size 
        const arc = d3.arc() // Function to draw the slices 
          .innerRadius(0) // Set the slices starting point exactly at the center of the pie
          .outerRadius(radius); // Set the slices ending point exactly at the end of the radius

        // Pie chart 1
        const pieGroup1 = svg.append('g')
          .attr('class', 'pie-chart') // Assign a class for styling or future selection
          .attr('transform', `translate(${width / 4}, ${height / 2})`) // Center pie chart in the first half of the svg
        const pieSlices1 = pieGroup1.selectAll('g.slice')
          .data(pie(pieData1)) // Convert pieData into slice geometry with 'pie' function
          .enter()
          .append('g')
          .attr('class', 'slice');
        pieSlices1.append('path') // For every item that doesnât have a path yet, create a <path> element
          .attr('d', arc) // Draw the slices with 'arc' function
          .attr('fill', d => d.data.color); // Uses the original color from your pieData
        // Add percentages
        const total1 = d3.sum(pieData1, d => d.value); // Total of the data
        const onlyOneSlice1 = pieData1.length === 1 // Check if there's only one value in the dataset
          || pieData1.every(d => (d.value / total1) === 0 // Check if any slice have a value of 0%
            || (d.value / total1) === 1); // Check if any slice have a value of 100%
        if (onlyOneSlice1) { // If there's only one slice
          pieGroup1.append('text')
            .attr('x', 0)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .attr('dominant-baseline', 'middle')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .attr('fill', '#000')
            .text('100%');
        } else {
          pieSlices1.append('text')
            .attr('transform', d => {
              const [x, y] = arc.centroid(d); // Geometrical center of the slice
              const offset = 1.4; // Offset from the center
              return `translate(${x * offset}, ${y * offset})`;
            })
            .attr('text-anchor', 'middle')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .attr('fill', '#000')
            .text(d => {
              const percent = (d.data.value / total1) * 100; // Percentage calculation
              return percent.toFixed(1) + '%';
            })
        }

        // Pie chart 2
        const pieGroup2 = svg.append('g')
          .attr('class', 'pie-chart') // Assign a class for styling or future selection
          .attr('transform', `translate(${3 * width / 4}, ${height / 2})`) // Center pie chart in the second half of the svg
        const pieSlices2 = pieGroup2.selectAll('g.slice')
          .data(pie(pieData2)) // Convert pieData into slice geometry with 'pie' function
          .enter()
          .append('g')
          .attr('class', 'slice');
        pieSlices2.append('path') // For every item that doesnât have a path yet, create a <path> element
          .attr('d', arc) // Draw the slices with 'arc' function
          .attr('fill', d => d.data.color); // Uses the original color from your pieData
        // Add percentages
        const total2 = d3.sum(pieData2, d => d.value); // Total of the data
        const nonZeroSlices2 = pieData2.filter(d => d.value > 0); // Filters for slices of 0%
        if (nonZeroSlices2.length === 1) { // If there's only one slice of 100%
          pieGroup2.append('text')
            .attr('x', 0)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .attr('dominant-baseline', 'middle')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .attr('fill', '#000')
            .text('100%');
        } else {
          pieSlices2
            .filter(d => d.data.value > 0)
            .append('text')
            .attr('transform', d => {
              const [x, y] = arc.centroid(d); // Geometrical center of the slice
              const offset = 1.4; // Offset from the center
              return `translate(${x * offset}, ${y * offset})`;
            })
            .attr('text-anchor', 'middle')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .attr('fill', '#000')
            .text(d => {
              const percent = (d.data.value / total2) * 100; // Percentage calculation
              return percent.toFixed(1) + '%';
            })
        }
      }
    }

    // Draw the histograms
    drawStackedChart('#pm2p5-bar-chart', pm2p5max, pm2p5mean, vulnerableGroupsByYear_pm2p5);
    drawStackedChart('#pm10-bar-chart', pm10max, pm10mean, vulnerableGroupsByYear_pm10);
    drawStackedChart('#no2-bar-chart', no2max, no2mean, vulnerableGroupsByYear_no2);

  </script><!-- GN: histogram function -->

</body>

</html>