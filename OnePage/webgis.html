<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>AirAware - WebGIS</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.5.0/ol.css">
  <style>
    #map {
      width: 100%;
      height: 600px;
      position: relative;
      overflow: hidden;
    }

    .ol-control.ol-full-screen button {
      width: 28px;
      height: 28px;
      font-size: 16px;
      border-radius: 2px;
      background: #fff;
      color: #333;
      box-shadow: 0 1px 4px rgba(0, 60, 136, .2);
      padding: 0;
      line-height: 1;
      display: inline-block;
      transition: background 0.2s;
      border: none;
    }

    .ol-control.ol-full-screen button:hover {
      background: #e6e6e6;
    }

    .ol-control.ol-recenter {
      background: none;
      box-shadow: none;
      padding: 0;
    }

    .ol-control.ol-recenter button {
      background: #fff;
      color: #333;
      border: none;
      border-radius: 2px;
      width: 28px;
      /* Match OpenLayers fullscreen button */
      height: 28px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(0, 60, 136, .2);
      padding: 0;
      line-height: 1;
      /* Remove flex properties */
      display: inline-block;
      align-items: unset;
      justify-content: unset;
      transition: background 0.2s;
    }

    .ol-control.ol-recenter button:hover {
      background: #e6e6e6;
    }

    .ol-mouse-position.custom-mouse-coords {
      box-sizing: content-box;
      white-space: nowrap;
      width: auto !important;
      max-width: 220px !important;
      height: auto !important;
      padding: 6px 12px !important;
      overflow: visible !important;
      text-overflow: clip !important;
      display: inline-block;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      line-height: 1.4;
      pointer-events: none;
      position: relative;
      z-index: 1100;
    }

    #mouse-coords-container {
      position: absolute;
      bottom: 3em;
      right: 1em;
      max-width: none !important;
      width: auto !important;
      pointer-events: none;
      z-index: 1000;
    }

    #map-controls {
      position: absolute;
      top: 0.5em;
      right: 0.5em;
      display: flex;
      gap: 0.5em;
      z-index: 1000;
      pointer-events: none;
    }

    #map-controls .ol-control {
      pointer-events: auto;
      margin: 0;
      position: static;
    }

    #map-legend {
      position: absolute;
      top: 4em;
      right: 1em;
      background: white;
      border: 1px solid #ccc;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 1px 6px rgba(0, 0, 0, 0.15);
      font-size: 14px;
      z-index: 1001;
      width: fit-content;
      max-width: 200px;
    }

    #map-legend h5 {
      margin: 0 0 10px;
      font-size: 16px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 4px;
    }
  </style>
</head>

<body class="webgis-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

      <a href="index.html" class="logo d-flex align-items-center me-auto">
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 class="sitename">AirAware</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="results.html">Results</a></li>
          <li><a href="webgis.html" class="active">WebGIS</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <!-- No extra header button on WebGIS page -->
    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title accent-background">
      <div class="container">
        <h1>WebGIS</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">WebGIS</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- WebGIS Section -->
    <section id="webgis" class="service-details section">
      <div class="container">
        <p>Use the interactive map below to explore air quality data. Pan and zoom the map to navigate, and click on
          markers or regions for more information. The map displays air quality measurements (such as pollutant
          concentrations or AQI) with color-coded markers and layers to indicate pollution levels.</p>
      </div>
      <div id="map">
        <div id="map-controls"></div>
        <div id="mouse-coords-container"></div>
        <div id="map-legend">
          <h5>Map Legend</h5>
          <label>
            <input type="checkbox" id="toggle-country-layer" checked>
            <span style="border-left: 12px solid red; padding-left: 6px;">Hungary Outline</span>
          </label>
          <div style="margin-top: 10px;">
            <input type="range" id="opacity-range" min="0" max="1" step="0.05" value="0.4">
          </div>
        </div>
      </div>
    </section>
    <!-- /WebGIS Section -->
  </main>

  <footer id="footer" class="footer light-background">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-5 col-md-12 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">AirAware</span>
          </a>
          <p>AirAware is committed to providing accessible air quality information for everyone.</p>
          <div class="social-links d-flex mt-4">
            <a href="#"><i class="bi bi-twitter"></i></a>
            <a href="#"><i class="bi bi-facebook"></i></a>
            <a href="#"><i class="bi bi-instagram"></i></a>
            <a href="#"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="results.html">Results</a></li>
            <li><a href="webgis.html">WebGIS</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Pollutants</h4>
          <ul>
            <li><a href="#">PM2.5</a></li>
            <li><a href="#">PM10</a></li>
            <li><a href="#">Nitrogen Dioxide (NO<sub>2</sub>)</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <p>AirAware Labs<br>123 Clean Air St.<br>City, Country</p>
          <p class="mt-4"><strong>Phone:</strong> <span>+1 (234) 567-890</span></p>
          <p><strong>Email:</strong> <span>contact@airaware.org</span></p>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1 sitename">AirAware</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.5.0/dist/ol.js"></script>
  <script>
    const initialZoom = 7;
    const initialCoordinates = [19.503, 47.165];
    var map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        })
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat(initialCoordinates),
        zoom: initialZoom
      })
    });

    // Add scale line, full screen, and mouse position controls
    class RecenterControl extends ol.control.Control {
      constructor(opt_options) {
        const options = opt_options || {};
        const button = document.createElement('button');
        button.innerHTML = '<i class="bi bi-crosshair"></i>';
        button.title = 'Recenter map';

        const element = document.createElement('div');
        element.className = 'ol-control ol-recenter ol-unselectable ol-control';
        element.appendChild(button);

        super({
          element: element,
          target: 'map-controls'
        });

        button.addEventListener('click', () => {
          map.getView().setCenter(ol.proj.fromLonLat(initialCoordinates));
          map.getView().setZoom(initialZoom);
        }, false);
      }
    }
    map.addControl(new RecenterControl({ target: 'map-controls' }));
    map.addControl(new ol.control.FullScreen({ target: 'map-controls' }));
    map.addControl(new ol.control.ScaleLine());
    map.addControl(new ol.control.MousePosition({
      coordinateFormat: ol.coordinate.createStringXY(4),
      projection: 'EPSG:4326',
      className: 'ol-mouse-position custom-mouse-coords',
      placeholder: '0.0000, 0.0000',
      target: document.getElementById('mouse-coords-container')
    }));


    let countryLayer;

    fetch('assets/data/hungary.geojson')
      .then(res => res.json())
      .then(geojson => {
        countryLayer = new ol.layer.Vector({
          source: new ol.source.Vector({
            features: new ol.format.GeoJSON().readFeatures(geojson, {
              featureProjection: 'EPSG:3857'
            })
          }),
          style: new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'red',
              width: 2
            }),
            fill: new ol.style.Fill({
              color: 'rgba(255, 0, 0, 0.4)'
            })
          })
        });

        map.addLayer(countryLayer);
        // Set initial opacity
        const opacityRange = document.getElementById('opacity-range');
        countryLayer.setOpacity(1);
        opacityRange.value = 1;

        // Listen for opacity changes
        opacityRange.addEventListener('input', function () {
          if (countryLayer) {
            countryLayer.setOpacity(parseFloat(this.value));
          }
        });
      });

    // --- ðŸ§² TOGGLE LAYER ON/OFF ---
    document.getElementById('toggle-country-layer').addEventListener('change', function () {
      if (countryLayer) {
        countryLayer.setVisible(this.checked);
      }
    });

    const toggleMain = document.getElementById('toggle-country-layer');
    const toggleLegend = document.getElementById('toggle-country-layer-legend');

    [toggleMain, toggleLegend].forEach(toggle => {
      toggle.addEventListener('change', function () {
        if (countryLayer) {
          const visible = this.checked;
          countryLayer.setVisible(visible);
          toggleMain.checked = visible;
          toggleLegend.checked = visible;
        }
      });
    });
    window.addEventListener('scroll', () => {
      const map = document.getElementById('map');
      const controls = document.getElementById('map-controls');
      const legend = document.getElementById('map-legend');

      if (!map || !controls || !legend) return;

      const rect = map.getBoundingClientRect();
      const isVisible = rect.top < window.innerHeight && rect.bottom > 0;

      controls.style.display = isVisible ? 'flex' : 'none';
      legend.style.display = isVisible ? 'block' : 'none';
    });

    // Trigger scroll handler once on page load to set initial visibility
    window.dispatchEvent(new Event('scroll'));
  </script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>